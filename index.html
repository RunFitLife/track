<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Run Fit Life</title>
<meta name="theme-color" content="#111827" />
<style>
:root{
  --bg:#f3f4f6;--card:#ffffff;--text:#111827;--muted:#6b7280;
  --primary:#111827;--danger:#b91c1c;--accent:#22c55e;
}
body.dark{
  --bg:#0f172a;--card:#020617;--text:#e5e7eb;
  --muted:#9ca3af;--primary:#e5e7eb;--accent:#4ade80;
}
*{box-sizing:border-box}
body{
  margin:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
  background:var(--bg);color:var(--text);line-height:1.4;
}
header{
  background:linear-gradient(135deg,#020617,#111827);
  color:#fff;padding:1.5rem 1rem;text-align:center;position:sticky;top:0;z-index:10;
}
header h1{margin:0;font-size:1.6rem}
header p{margin:.25rem 0 .75rem;color:#d1d5db}
main{padding:1rem;max-width:900px;margin:auto}
h2{margin-top:1.25rem;font-size:1.25rem}
h3{margin-top:1rem;font-size:1.05rem}
form,.card{
  background:var(--card);padding:1rem;border-radius:18px;
  box-shadow:0 10px 25px rgba(0,0,0,.12);margin-bottom:1rem;
}
label{display:block;margin-top:.75rem;font-weight:600;font-size:.9rem}
input,textarea,select{
  width:100%;padding:.65rem .75rem;margin-top:.25rem;
  border-radius:10px;border:1px solid #374151;font-size:.95rem;
  background:var(--bg);color:var(--text);
}
textarea{resize:none}
button{
  padding:.65rem .9rem;border-radius:999px;border:none;
  font-weight:600;cursor:pointer;transition:.2s;
}
button:hover{transform:scale(1.02)}
button.primary{background:var(--primary);color:var(--bg);width:100%;margin-top:1rem}
button.secondary{background:#6b7280;color:#fff}
button.danger{background:var(--danger);color:#fff}
button.small{font-size:.75rem;padding:.3rem .6rem}
.row{display:grid;grid-template-columns:1fr 1fr;gap:.75rem}
.entry{
  background:var(--card);padding:.75rem 1rem;border-radius:14px;
  box-shadow:0 4px 12px rgba(0,0,0,.12);
  display:flex;justify-content:space-between;align-items:center;gap:.75rem;
}
.entry strong{font-size:.95rem}
.entry span{font-size:.85rem;color:var(--muted)}
.entry em{font-size:.85rem;color:var(--muted)}
select.maxSelect{margin-top:.5rem;padding:.5rem;border-radius:10px;font-size:.9rem;}
footer{text-align:center;font-size:.8rem;color:var(--muted);margin:2rem 0 1rem}
</style>
</head>
<body>
<header>
  <h1>Run Fit Life</h1>
  <p>Run towards a healthier life</p>
  <button class="small" type="button" onclick="toggleDark()">üåô / ‚òÄÔ∏è</button>
</header>

<main>
<form id="workoutForm">
  <h2>‚ûï Nuevo entrenamiento</h2>
  <label>D√≠a de rutina</label>
  <select id="day" required>
    <option>D√≠a 1 - Empuje</option>
    <option>D√≠a 2 - Tir√≥n</option>
    <option>D√≠a 3 - Piernas y Gl√∫teo</option>
    <option>D√≠a 4 - Abdominales</option>
  </select>

  <label>Ejercicio</label>
  <select id="exercise" required></select>

  <div class="row">
    <div><label>Peso (kg)</label><input type="number" id="weight" step="0.001" required></div>
    <div><label>Series</label><input type="number" id="sets" required></div>
  </div>

  <label>Repeticiones</label>
  <input type="number" id="reps" required>

  <label>Notas</label>
  <textarea id="notes"></textarea>

  <button class="primary" type="submit">Guardar</button>
</form>

<div class="card">
  <h2>üîç Filtrar por fecha</h2>
  <input type="date" id="filterDate">
</div>

<div id="log"></div>

<div class="card">
  <h2>üìä M√°ximo hist√≥rico por ejercicio</h2>
  <label>Selecciona ejercicio</label>
  <select id="maxExercise" class="maxSelect"></select>
  <p id="maxWeight"></p>
</div>

<div class="card">
  <h2>üì¶ Gesti√≥n de datos</h2>
  <button class="secondary" type="button" onclick="exportCSV()">Exportar CSV</button>
  <button class="secondary" type="button" onclick="exportBackup()">‚¨áÔ∏è Copia de seguridad JSON</button>
  <input type="file" id="importFile" accept="application/json" onchange="importBackup(event)">
  <button class="danger" type="button" onclick="clearAll()">Borrar todo</button>
</div>

<footer>Run Fit Life ¬∑ PWA</footer>

<script>
/* ================== CONFIG ================== */
const exercisesByDay = {
  'D√≠a 1 - Empuje': {
    'Pecho': ['Press banca','Press banca inclinado','Press banca declinado','Press banca en m√°quina','Aperturas en m√°quina','M√°quina pectoral alemana','Press banca con mancuernas','Press banca inclinado con mancuernas'],
    'Hombro': ['Press militar con mancuernas','Press militar con barra','Elevaciones frontales con mancuernas','Elevaciones frontales con polea','Elevaciones frontales lamine','Elevaciones laterales con mancuernas','Elevaciones laterales con polea','M√°quina de press de hombro','M√°quina de aperturas de hombro','M√°quina alemana de hombro','Barra a la barbilla'],
    'Tr√≠ceps': ['Extensi√≥n de tr√≠ceps con cuerda','Extensi√≥n de tr√≠ceps con polea','Extensi√≥n de tr√≠ceps con barra','Extensi√≥n de tr√≠ceps unilateral con polea','Tr√≠ceps katana','Extensi√≥n de tr√≠ceps por encima de la cabeza con polea','Fondos en m√°quina sentada','Fondos en m√°quina de dominadas']
  },
  'D√≠a 2 - Tir√≥n': {
    'Espalda': ['Remo con barra T','Iso-lateral Row','Iso-lateral D.Y. Row','Iso-lateral High Row','Iso-lateral Front Lat Pulldown','Remo con barra','Remo sentado con polea','Pullover','Dominadas','Jal√≥n al pecho agarre neutro','Jal√≥n al pecho agarre cerrado','Jal√≥n al pecho agarre abierto','Jal√≥n m√°quina amarilla','Remo normal m√°quina amarilla','Remo bajo m√°quina amarilla','Remo unilateral'],
    'B√≠ceps': ['Curl de b√≠ceps con barra','Curl de b√≠ceps con mancuernas','Curl de b√≠ceps en banco Scott','Curl de b√≠ceps cerrado en m√°quina amarilla','Curl de b√≠ceps concentrado con mancuerna','Curl de b√≠ceps en banco inclinado (brazos atr√°s)','Curl de b√≠ceps bayesian','Curl martillo con mancuernas','Curl martillo en polea'],
    'Hombro posterior': ['Posterior en m√°quina de aperturas','Aperturas posterior en polea unilateral','Facepull','P√°jaros posterior']
  },
  'D√≠a 3 - Piernas y Gl√∫teo': {
    'Cu√°driceps': ['Sentadilla con barra','Sentadilla en multipower','Prensa de pierna con discos','Prensa de pierna con m√°quina','Hack sentadilla','Extensi√≥n de cu√°driceps con m√°quina amarilla','Extensi√≥n de cu√°driceps con m√°quina','Sentadilla b√∫lgara','Zancadas con peso','Sentadilla sumo con peso','Sentadilla con mancuerna'],
    'Femoral': ['Peso muerto','Femoral en m√°quina acostada','Femoral en m√°quina sentada','Femoral en m√°quina unilateral de pie'],
    'Gl√∫teo': ['Hip thrust','Puente de gl√∫teo con peso','Patada de gl√∫teo en m√°quina','Patada de gl√∫teo en polea'],
    'Aductores / Abductores': ['Abductor en m√°quina sentada','Abductor en m√°quina de pie','Aductor en m√°quina sentada'],
    'Gemelos': ['S√≥leo','Gemelos en prensa']
  },
  'D√≠a 4 - Abdominales': {
    'Abdominales': ['Plancha isom√©trica','Plancha lateral','Crunch abdominal acostado','Crunch abdominal en polea','Crunch abdominal en m√°quina','Elevaciones de piernas','Bichos boca arriba','Abdominales oblicuos']
  }
};

/* ================== ELEMENTS ================== */
const qs=id=>document.getElementById(id);
const form=qs('workoutForm');
const daySelect=qs('day');
const exerciseSelect=qs('exercise');
const filterDate=qs('filterDate');
const log=qs('log');
const maxSelect=qs('maxExercise');
const maxWeightEl=qs('maxWeight');
const importFile=qs('importFile');

/* ================== DATA ================== */
const STORAGE_KEY='gym_workouts';
function getData(){return JSON.parse(localStorage.getItem(STORAGE_KEY))||[];}
function saveData(d){localStorage.setItem(STORAGE_KEY,JSON.stringify(d));}

/* ================== WORKOUT ================== */
function updateExerciseOptions(){
  exerciseSelect.innerHTML='';
  const day = daySelect.value;
  const groups = exercisesByDay[day];
  Object.keys(groups).forEach(groupName=>{
    const optgroup=document.createElement('optgroup');
    optgroup.label=groupName;
    groups[groupName].forEach(ex=>{
      const o=document.createElement('option'); o.textContent=ex;
      optgroup.appendChild(o);
    });
    exerciseSelect.appendChild(optgroup);
  });
  const isAbs = day==='D√≠a 4 - Abdominales';
  qs('weight').disabled=isAbs;
  qs('weight').required=!isAbs;
  if(isAbs) qs('weight').value=0;
}

function refresh(){
  const data=getData();
  const filtered=filterDate.value?data.filter(w=>w.date===filterDate.value):data.filter(w=>w.date===today());
  renderLog(filtered);
  renderMaxSelect(data);
}

function renderLog(data){
  log.innerHTML='';
  data.forEach((w,i)=>{
    const e=document.createElement('div');
    e.className='entry';
    e.innerHTML = `
      <div>
        <strong>${w.exercise}</strong><br>
        <span>${formatNumber(w.weight)} kg ¬∑ ${w.sets}x${w.reps}</span><br>
        ${w.notes ? `<em>Notas: ${w.notes}</em>` : ''}
      </div>
      <button class="danger small" onclick="deleteEntry(${i})">üóëÔ∏è</button>
    `;
    log.appendChild(e);
  });
}

function deleteEntry(i){const d=getData();d.splice(i,1);saveData(d);refresh();}
function formatNumber(n){return Number.isInteger(n)?n:n.toFixed(3).replace(/\.?0+$/,'');}

/* ================== M√ÅXIMO HIST√ìRICO ================== */
function renderMaxSelect(data){
  const exercises = [...new Set(data.map(w=>w.exercise))].sort();
  maxSelect.innerHTML='';
  exercises.forEach(ex=>{
    const o=document.createElement('option');
    o.value=ex;
    o.textContent=ex;
    maxSelect.appendChild(o);
  });
  if(exercises.length>0) showMax(exercises[0]);
  else maxWeightEl.textContent='';
}

function showMax(ex){
  const data=getData().filter(w=>w.exercise===ex);
  if(!data.length){maxWeightEl.textContent='No hay datos'; return;}
  let maxEntry = data.reduce((a,b)=>b.weight>a.weight?b:a);
  maxWeightEl.textContent=`M√°ximo hist√≥rico: ${formatNumber(maxEntry.weight)} kg ¬∑ ${maxEntry.date}`;
}

maxSelect.addEventListener('change',()=>showMax(maxSelect.value));

/* ================== DATA EXPORT/IMPORT ================== */
function exportCSV(){
  const d=getData();
  let csv='Fecha,D√≠a,Ejercicio,Peso,Series,Reps,Notas\n';
  d.forEach(w=>csv+=`${w.date},${w.day},${w.exercise},${w.weight},${w.sets},${w.reps},"${w.notes}"\n`);
  download(csv,'runfitlife.csv','text/csv');
}

function exportBackup(){download(JSON.stringify(getData()),'backup.json','application/json');}

function importBackup(e){
  const f=e.target.files[0];
  if(!f) return;
  const r=new FileReader();
  r.onload=()=>{
    try{
      saveData(JSON.parse(r.result));
      refresh();
      importFile.value='';
      alert('Importaci√≥n completada ‚úÖ');
    }catch(err){alert('Error al importar JSON ‚ùå');}
  };
  r.readAsText(f);
}

function clearAll(){
  if(confirm('¬øSeguro que quieres borrar todo?')){
    localStorage.removeItem(STORAGE_KEY);
    refresh();
  }
}

function download(c,n,t){const a=document.createElement('a');a.href=URL.createObjectURL(new Blob([c],{type:t}));a.download=n;a.click();}

/* ================== UTIL ================== */
function today(){return new Date().toISOString().split('T')[0];}
function toggleDark(){document.body.classList.toggle('dark');}

/* ================== FORM ================== */
form.addEventListener('submit',e=>{
  e.preventDefault();
  const d=getData();
  d.push({
    day:daySelect.value,
    exercise:exerciseSelect.value,
    weight:+qs('weight').value,
    sets:+qs('sets').value,
    reps:+qs('reps').value,
    notes:qs('notes').value,
    date:today()
  });
  saveData(d);
  form.reset();
  updateExerciseOptions();
  refresh();
});

/* ================== INIT ================== */
filterDate.value=today();
updateExerciseOptions();
refresh();
</script>
</body>
</html>
