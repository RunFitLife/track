<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Run Fit Life</title>
<meta name="theme-color" content="#111827" />
<style>
:root{
  --bg:#f3f4f6;--card:#ffffff;--text:#111827;--muted:#6b7280;
  --primary:#111827;--danger:#b91c1c;--accent:#22c55e;
}
body.dark{
  --bg:#0f172a;--card:#020617;--text:#e5e7eb;
  --muted:#9ca3af;--primary:#e5e7eb;--accent:#4ade80;
}
*{box-sizing:border-box}
body{
  margin:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
  background:var(--bg);color:var(--text);line-height:1.4;
}
header{
  background:linear-gradient(135deg,#020617,#111827);
  color:#fff;padding:1.5rem 1rem;text-align:center;position:sticky;top:0;z-index:10;
}
header h1{margin:0;font-size:1.6rem}
header p{margin:.25rem 0 .75rem;color:#d1d5db}
main{padding:1rem;max-width:900px;margin:auto}
h2{margin-top:1.25rem;font-size:1.25rem}
h3{margin-top:1rem;font-size:1.05rem}
form,.card{
  background:var(--card);padding:1rem;border-radius:18px;
  box-shadow:0 10px 25px rgba(0,0,0,.12);margin-bottom:1rem;
}
label{display:block;margin-top:.75rem;font-weight:600;font-size:.9rem}
input,textarea,select{
  width:100%;padding:.65rem .75rem;margin-top:.25rem;
  border-radius:10px;border:1px solid #374151;font-size:.95rem;
  background:var(--bg);color:var(--text);
}
textarea{resize:none}
button{
  padding:.65rem .9rem;border-radius:999px;border:none;
  font-weight:600;cursor:pointer;transition:.2s;
}
button:hover{transform:scale(1.02)}
button.primary{background:var(--primary);color:var(--bg);width:100%;margin-top:1rem}
button.secondary{background:#6b7280;color:#fff}
button.danger{background:var(--danger);color:#fff}
button.small{font-size:.75rem;padding:.3rem .6rem}
.row{display:grid;grid-template-columns:1fr 1fr;gap:.75rem}
.entry{
  background:var(--card);padding:.75rem 1rem;border-radius:14px;
  box-shadow:0 4px 12px rgba(0,0,0,.12);
  display:flex;justify-content:space-between;align-items:center;gap:.75rem;
}
.entry strong{font-size:.95rem}
.entry span{font-size:.85rem;color:var(--muted)}
.badge{
  display:inline-block;padding:.25rem .6rem;border-radius:999px;
  font-size:.75rem;background:var(--accent);color:#022c22;font-weight:600;
  margin:.15rem;
}
footer{text-align:center;font-size:.8rem;color:var(--muted);margin:2rem 0 1rem}
canvas{width:100%;max-height:260px;margin-top:.5rem}
</style>
</head>

<body>
<header>
  <h1>Run Fit Life</h1>
  <p>Run towards a healthier life</p>
  <button class="small" type="button" onclick="toggleDark()">ğŸŒ™ / â˜€ï¸</button>
</header>

<main>

<!-- ================= ENTRENAMIENTOS ================= -->
<form id="workoutForm">
  <h2>â• Nuevo entrenamiento</h2>

  <label>DÃ­a de rutina</label>
  <select id="day">
    <option>DÃ­a 1 - Empuje</option>
    <option>DÃ­a 2 - TirÃ³n</option>
    <option>DÃ­a 3 - Piernas y GlÃºteo</option>
    <option>DÃ­a 4 - Abdominales</option>
  </select>

  <label>Ejercicio</label>
  <select id="exercise"></select>

  <div class="row">
    <div><label>Peso (kg)</label><input type="number" id="weight" step="0.5"></div>
    <div><label>Series</label><input type="number" id="sets"></div>
  </div>

  <label>Repeticiones</label>
  <input type="number" id="reps">

  <label>Notas</label>
  <textarea id="notes"></textarea>

  <button class="primary" type="submit">Guardar</button>
</form>

<div class="card">
  <h2>ğŸ” Filtrar por fecha</h2>
  <input type="date" id="filterDate">
</div>

<div id="log"></div>

<div class="card">
  <h2>ğŸ“ˆ EstadÃ­sticas</h2>
  <canvas id="chart"></canvas>
  <p id="volume"></p>
  <p id="stats"></p>
</div>

<div class="card">
  <h2>ğŸ† Logros y medallas</h2>
  <div id="medals"></div>
  <p id="achievements"></p>
</div>

<div class="card">
  <h2>ğŸ“… Resumen</h2>
  <p id="weeklySummary"></p>
  <p id="monthlySummary"></p>
</div>

<div class="card">
  <h2>ğŸ’ª RÃ©cords personales</h2>
  <p id="records"></p>
</div>

<!-- ================= CONTROL CORPORAL ================= -->
<div class="card">
  <h2>âš–ï¸ Control corporal mensual</h2>

  <div class="card">
    <h3>ğŸ“Š Ãšltimo pesaje</h3>
    <div id="lastBody">No hay datos aÃºn</div>
  </div>

  <form id="bodyForm">
    <label>Fecha</label>
    <input type="month" id="bodyDate" required>

    <div class="row">
      <div><label>Peso (kg)</label><input type="number" step="0.1" id="bodyWeight" required></div>
      <div><label>Agua (kg)</label><input type="number" step="0.1" id="bodyWater"></div>
    </div>

    <div class="row">
      <div><label>MÃºsculo (kg)</label><input type="number" step="0.1" id="bodyMuscle"></div>
      <div><label>Grasa (kg)</label><input type="number" step="0.1" id="bodyFat"></div>
    </div>

    <div class="row">
      <div><label>Hueso sin grasa (kg)</label><input type="number" step="0.1" id="bodyBone"></div>
      <div><label>Grasa visceral</label><input type="number" step="0.1" id="bodyVisceral"></div>
    </div>

    <button class="primary" type="submit">Guardar mediciÃ³n</button>
  </form>

  <button class="secondary" onclick="toggleBodyHistory()">ğŸ“‚ Ver / ocultar historial</button>
  <div id="bodyHistory" style="display:none;"></div>

  <canvas id="bodyChart"></canvas>
</div>

<div class="card">
  <h2>ğŸ“¦ GestiÃ³n de datos</h2>
  <button class="secondary" onclick="exportCSV()">Exportar CSV</button>
  <button class="secondary" onclick="exportBackup()">â¬‡ï¸ Copia de seguridad</button>
  <input type="file" id="importFile" accept="application/json" onchange="importBackup(event)">
  <button class="danger" onclick="clearAll()">Borrar todo</button>
</div>

</main>

<footer>Run Fit Life Â· PWA</footer>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
/* ================== CONFIG Y DATA ================== */
const STORAGE_KEY='gym_workouts';
const BODY_KEY='body_tracking';
const qs=id=>document.getElementById(id);
const uniq=a=>[...new Set(a)];
const today=()=>new Date().toISOString().split('T')[0];

function getData(){return JSON.parse(localStorage.getItem(STORAGE_KEY))||[];}
function saveData(d){localStorage.setItem(STORAGE_KEY,JSON.stringify(d));}
function getBodyData(){return JSON.parse(localStorage.getItem(BODY_KEY))||[];}
function saveBodyData(d){localStorage.setItem(BODY_KEY,JSON.stringify(d));}

/* ================== WORKOUT ================== */
const exercisesByDay={
  'DÃ­a 1 - Empuje':{Pecho:['Press banca'],Hombro:['Press militar'],TrÃ­ceps:['ExtensiÃ³n polea']},
  'DÃ­a 2 - TirÃ³n':{Espalda:['Remo'],BÃ­ceps:['Curl bÃ­ceps']},
  'DÃ­a 3 - Piernas y GlÃºteo':{Piernas:['Sentadilla','Prensa']},
  'DÃ­a 4 - Abdominales':{Core:['Plancha','Crunch']}
};

function updateExerciseOptions(){
  const day=qs('day').value;
  const sel=qs('exercise');
  sel.innerHTML='';
  Object.values(exercisesByDay[day]).flat().forEach(e=>{
    const o=document.createElement('option');
    o.textContent=e;
    sel.appendChild(o);
  });
}

qs('workoutForm').addEventListener('submit',e=>{
  e.preventDefault();
  const d=getData();
  d.push({
    day:qs('day').value,
    exercise:qs('exercise').value,
    weight:+qs('weight').value||0,
    sets:+qs('sets').value||0,
    reps:+qs('reps').value||0,
    notes:qs('notes').value,
    date:today()
  });
  saveData(d);
  e.target.reset();
  updateExerciseOptions();
  refresh();
});

function refresh(){
  renderLog(getData());
}

function renderLog(d){
  const log=qs('log');
  log.innerHTML='';
  d.forEach((w,i)=>{
    log.innerHTML+=`
      <div class="entry">
        <div>
          <strong>${w.exercise}</strong><br>
          <span>${w.weight}kg Â· ${w.sets}x${w.reps}</span>
        </div>
        <button class="danger small" onclick="deleteWorkout(${i})">ğŸ—‘ï¸</button>
      </div>`;
  });
}

function deleteWorkout(i){
  const d=getData();
  d.splice(i,1);
  saveData(d);
  refresh();
}

/* ================== BODY ================== */
let bodyChart=null;

qs('bodyForm').addEventListener('submit',e=>{
  e.preventDefault();
  const d=getBodyData();
  d.push({
    date:qs('bodyDate').value,
    weight:+qs('bodyWeight').value,
    water:+qs('bodyWater').value||0,
    muscle:+qs('bodyMuscle').value||0,
    fat:+qs('bodyFat').value||0,
    bone:+qs('bodyBone').value||0,
    visceral:+qs('bodyVisceral').value||0
  });
  saveBodyData(d);
  e.target.reset();
  renderLastBody();
  renderBodyHistory();
  renderBodyChart();
});

function renderLastBody(){
  const d=getBodyData();
  const div=qs('lastBody');
  if(!d.length){div.textContent='No hay datos aÃºn';return;}
  const u=d[d.length-1];
  div.innerHTML=`
    <strong>${u.date}</strong><br>
    Peso: ${u.weight} kg<br>
    MÃºsculo: ${u.muscle} Â· Grasa: ${u.fat}<br>
    Agua: ${u.water} Â· Hueso: ${u.bone}<br>
    Grasa visceral: ${u.visceral}`;
}

function renderBodyHistory(){
  const d=getBodyData();
  const div=qs('bodyHistory');
  div.innerHTML='';
  d.forEach((x,i)=>{
    div.innerHTML+=`
      <div class="entry">
        <div>${x.date}<br>${x.weight}kg</div>
        <button class="danger small" onclick="deleteBody(${i})">ğŸ—‘ï¸</button>
      </div>`;
  });
}

function deleteBody(i){
  const d=getBodyData();
  d.splice(i,1);
  saveBodyData(d);
  renderLastBody();
  renderBodyHistory();
  renderBodyChart();
}

function toggleBodyHistory(){
  const d=qs('bodyHistory');
  d.style.display=d.style.display==='none'?'block':'none';
  renderBodyHistory();
}

function renderBodyChart(){
  const d=getBodyData();
  if(bodyChart) bodyChart.destroy();
  if(!d.length) return;
  bodyChart=new Chart(qs('bodyChart'),{
    type:'line',
    data:{
      labels:d.map(x=>x.date),
      datasets:[
        {label:'Peso',data:d.map(x=>x.weight)},
        {label:'MÃºsculo',data:d.map(x=>x.muscle)},
        {label:'Grasa',data:d.map(x=>x.fat)}
      ]
    }
  });
}

/* ================== EXPORT / IMPORT ================== */
function exportCSV(){
  const d=getData();
  let csv='Fecha,DÃ­a,Ejercicio,Peso,Series,Reps,Notas\n';
  d.forEach(w=>csv+=`${w.date},${w.day},${w.exercise},${w.weight},${w.sets},${w.reps},"${w.notes}"\n`);
  download(csv,'runfitlife.csv','text/csv');
}
function exportBackup(){download(JSON.stringify(getData()),'backup.json','application/json');}
function importBackup(e){
  const f=e.target.files[0];
  if(!f) return;
  const r=new FileReader();
  r.onload=()=>{saveData(JSON.parse(r.result));refresh();};
  r.readAsText(f);
}
function clearAll(){
  if(confirm('Â¿Seguro?')){
    localStorage.clear();
    refresh();
    renderBodyChart();
    renderLastBody();
    renderBodyHistory();
  }
}
function download(c,n,t){
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([c],{type:t}));
  a.download=n;
  a.click();
}

function toggleDark(){document.body.classList.toggle('dark');}

/* INIT */
qs('filterDate').value=today();
updateExerciseOptions();
refresh();
renderLastBody();
renderBodyChart();
</script>

</body>
</html>
