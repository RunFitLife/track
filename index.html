<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Run Fit Life</title>
  <meta name="theme-color" content="#111827">
  <style>
    :root { --bg:#f3f4f6; --card:#ffffff; --text:#111827; --muted:#6b7280; --primary:#111827; --danger:#b91c1c; }
    body.dark { --bg:#0f172a; --card:#020617; --text:#e5e7eb; --muted:#9ca3af; --primary:#e5e7eb; }
    body { font-family: system-ui, sans-serif; margin:0; background:var(--bg); color:var(--text); }
    header { background:var(--primary); color:var(--bg); padding:1rem; text-align:center; }
    main { padding:1rem; max-width:900px; margin:auto; }
    h2 { margin-top:2rem; }
    form,.card { background:var(--card); padding:1rem; border-radius:14px; box-shadow:0 4px 10px rgba(0,0,0,.15); }
    label { display:block; margin-top:.75rem; font-weight:600; }
    input,textarea,select,button { width:100%; padding:.6rem; margin-top:.25rem; border-radius:8px; border:1px solid #374151; font-size:1rem; background:var(--bg); color:var(--text); }
    button { background:var(--primary); color:var(--bg); border:none; margin-top:1rem; font-weight:600; }
    button.secondary { background:#6b7280; }
    button.danger { background:var(--danger); }
    button.small { font-size:.8rem; padding:.3rem .5rem; }
    .entry { background:var(--card); margin-top:1rem; padding:.75rem; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,.15); display:flex; justify-content:space-between; gap:.5rem; }
    .row { display:grid; grid-template-columns:1fr 1fr; gap:.5rem; }
    footer { text-align:center; font-size:.85rem; color:var(--muted); margin:2rem 0; }
    canvas { width:100%; max-height:280px; }
  </style>
</head>
<body>
<header>
  <h1>ğŸ‹ï¸ Run Fit Life</h1>
  <p>Registra, analiza y mejora tus entrenamientos</p>
  <button class="small" onclick="toggleDark()">ğŸŒ™ / â˜€ï¸</button>
</header>
<main>
<form id="workoutForm">
  <h2>â• Nuevo entrenamiento</h2>
  <label>DÃ­a de rutina</label>
  <select id="day" required>
    <option>DÃ­a 1 - Empuje</option>
    <option>DÃ­a 2 - TirÃ³n</option>
    <option>DÃ­a 3 - Piernas y GlÃºteo</option>
  </select>
  <label>Ejercicio</label>
  <select id="exercise" required></select>
  <div class="row">
    <div><label>Peso (kg)</label><input type="number" id="weight" step="0.5" required></div>
    <div><label>Series</label><input type="number" id="sets" required></div>
  </div>
  <label>Repeticiones</label>
  <input type="number" id="reps" required>
  <label>Notas</label>
  <textarea id="notes"></textarea>
  <button type="submit">Guardar</button>
</form>

<div class="card">
  <h2>ğŸ” Filtrar por ejercicio</h2>
  <select id="filter"></select>
</div>

<div class="card">
  <h2>ğŸ“ˆ Progreso</h2></h2>
  <canvas id="chart"></canvas>
  <p id="volume"></p>
</div>

<h2>ğŸ“‹ Historial</h2>
<div class="card">
  <label>Filtrar por dÃ­a</label>
  <select id="filterDay">
    <option value="">Todos</option>
    <option>DÃ­a 1 - Empuje</option>
    <option>DÃ­a 2 - TirÃ³n</option>
    <option>DÃ­a 3 - Piernas y GlÃºteo</option>
  </select>
</div>
<div id="log"></div>

<div class="card">
  <h2>ğŸ“Š EstadÃ­sticas avanzadas</h2>
  <p id="stats"></p>
</div>

<div class="card">
  <h2>ğŸ“¦ GestiÃ³n de datos</h2>
  <button class="secondary" onclick="exportCSV()">Exportar CSV</button>
<button class="secondary" onclick="exportBackup()">â¬‡ï¸ Copia de seguridad</button>
<input type="file" id="importFile" accept="application/json" onchange="importBackup(event)">()">Exportar CSV</button>
  <button class="danger" onclick="clearAll()">Borrar todo</button>
</div>
</main>
<footer>Run Fit Life Â· PWA</footer>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const exercisesByDay={
  'DÃ­a 1 - Empuje':['Press banca','Press banca inclinado','Press banca declinado','Aperturas en mÃ¡quina','Press militar','Elevaciones frontales','Elevaciones laterales','TrÃ­ceps polea','Fondos'],
  'DÃ­a 2 - TirÃ³n':['Remo con barra','JalÃ³n al pecho','Remo polea','Face pull','Curl bÃ­ceps','Curl martillo'],
  'DÃ­a 3 - Piernas y GlÃºteo':['Sentadilla','Prensa','Peso muerto','Hip thrust','ExtensiÃ³n cuadrÃ­ceps','Femoral','Gemelos']
};

const STORAGE_KEY='gym_workouts';
const form=document.getElementById('workoutForm');
const daySelect=document.getElementById('day');
const exerciseSelect=document.getElementById('exercise');
const filter=document.getElementById('filter');
const filterDay=document.getElementById('filterDay');
const log=document.getElementById('log');
const ctx=document.getElementById('chart');
const volumeEl=document.getElementById('volume');
let chart;

const getData=()=>JSON.parse(localStorage.getItem(STORAGE_KEY))||[];
const saveData=d=>localStorage.setItem(STORAGE_KEY,JSON.stringify(d));

function updateExerciseOptions(){
  exerciseSelect.innerHTML='';
  exercisesByDay[daySelect.value].forEach(e=>{
    const o=document.createElement('option');o.textContent=e;exerciseSelect.appendChild(o);
  });
}

daySelect.addEventListener('change',updateExerciseOptions);

function refresh(){
  const data=getData();
  let filtered=[...data];
  if(filterDay.value) filtered=filtered.filter(w=>w.day===filterDay.value);
  if(filter.value) filtered=filtered.filter(w=>w.exercise===filter.value);
  loadFilter(data);
  renderLog(filtered);
  renderChart(filtered);
}

function loadFilter(data){
  const ex=[...new Set(data.map(w=>w.exercise))];
  filter.innerHTML='<option value="">Todos</option>'+ex.map(e=>`<option>${e}</option>`).join('');
}

function renderLog(data){
  log.innerHTML='';
  const grouped={};
  data.forEach(w=>{
    grouped[w.date]=grouped[w.date]||[];
    grouped[w.date].push(w);
  });
  Object.keys(grouped).reverse().forEach(date=>{
    const dayDiv=document.createElement('div');
    dayDiv.className='card';
    dayDiv.innerHTML=`<h3>ğŸ“… ${date}</h3>`;
    grouped[date].forEach((w,i)=>{
      const e=document.createElement('div');
      e.className='entry';
      e.innerHTML=`<div><strong>${w.day} - ${w.exercise}</strong><br>${w.weight}kg Â· ${w.sets}x${w.reps}</div><button class="danger small" onclick="deleteOne(${i})">ğŸ—‘ï¸</button>`;
      dayDiv.appendChild(e);
    });
    log.appendChild(dayDiv);
  });
} - ${w.exercise}</strong><br>${w.weight}kg Â· ${w.sets}x${w.reps}<br><small>${w.date}</small></div><button class="danger small" onclick="deleteOne(${i})">ğŸ—‘ï¸</button>`;
    log.appendChild(div);
  });
}

function renderChart(data){
  if(chart) chart.destroy();
  if(!data.length){ volumeEl.textContent=''; document.getElementById('stats').textContent=''; return; }
  chart=new Chart(ctx,{type:'line',data:{labels:data.map(w=>w.date),datasets:[{label:'Peso',data:data.map(w=>w.weight)}]}});
  const totalVol=data.reduce((a,w)=>a+w.weight*w.sets*w.reps,0);
  volumeEl.textContent='Volumen total: '+totalVol;

  const byExercise={};
  data.forEach(w=>{
    byExercise[w.exercise]=byExercise[w.exercise]||[];
    byExercise[w.exercise].push(w.weight);
  });
  let best=''; let bestVal=0;
  Object.keys(byExercise).forEach(e=>{
    const max=Math.max(...byExercise[e]);
    if(max>bestVal){bestVal=max;best=`${e} (${max} kg)`;}
  });
  const stats=`Entrenamientos: ${data.length} Â· Mejor marca: ${best}`;
  document.getElementById('stats').textContent=stats;
}]}});
  volumeEl.textContent='Volumen total: '+data.reduce((a,w)=>a+w.weight*w.sets*w.reps,0);
}

form.addEventListener('submit',e=>{
  e.preventDefault();
  const d=getData();
  d.push({day:daySelect.value,exercise:exerciseSelect.value,weight:+weight.value,sets:+sets.value,reps:+reps.value,notes:notes.value,date:new Date().toLocaleDateString()});
  saveData(d);form.reset();updateExerciseOptions();refresh();
});

filter.addEventListener('change',refresh);
filterDay.addEventListener('change',refresh);

function deleteOne(i){const d=getData();d.splice(i,1);saveData(d);refresh();}
function clearAll(){if(confirm('Â¿Borrar todo?')){localStorage.removeItem(STORAGE_KEY);refresh();}}
function exportBackup(){
  const data=getData();
  const blob=new Blob([JSON.stringify(data)],{type:'application/json'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='run_fit_life_backup.json';
  a.click();
}

function importBackup(e){
  const file=e.target.files[0];
  if(!file) return;
  const reader=new FileReader();
  reader.onload=()=>{
    if(confirm('Â¿Restaurar datos? Se sobrescribirÃ¡ todo.')){
      localStorage.setItem(STORAGE_KEY,reader.result);
      refresh();
    }
  };
  reader.readAsText(file);
}

function exportCSV(){const d=getData();let c='DÃ­a,Fecha,Ejercicio,Peso,Series,Reps\n';d.forEach(w=>c+=`${w.day},${w.date},${w.exercise},${w.weight},${w.sets},${w.reps}\n`);const b=new Blob([c]);const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='run_fit_life.csv';a.click();}
function toggleDark(){document.body.classList.toggle('dark');}

updateExerciseOptions();refresh();
</script>
</body>
</html>
