<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Run Fit Life</title>
<meta name="theme-color" content="#111827" />
<style>
:root{
  --bg:#f3f4f6;--card:#ffffff;--text:#111827;--muted:#6b7280;
  --primary:#111827;--danger:#b91c1c;--accent:#22c55e;
}
body.dark{
  --bg:#0f172a;--card:#020617;--text:#e5e7eb;
  --muted:#9ca3af;--primary:#e5e7eb;--accent:#4ade80;
}
*{box-sizing:border-box}
body{
  margin:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
  background:var(--bg);color:var(--text);line-height:1.4;
}
header{
  background:linear-gradient(135deg,#020617,#111827);
  color:#fff;padding:1.5rem 1rem;text-align:center;position:sticky;top:0;z-index:10;
}
header h1{margin:0;font-size:1.6rem}
header p{margin:.25rem 0 .75rem;color:#d1d5db}
main{padding:1rem;max-width:900px;margin:auto}
h2{margin-top:1.25rem;font-size:1.25rem}
h3{margin-top:1rem;font-size:1.05rem}
form,.card{
  background:var(--card);padding:1rem;border-radius:18px;
  box-shadow:0 10px 25px rgba(0,0,0,.12);margin-bottom:1rem;
}
label{display:block;margin-top:.75rem;font-weight:600;font-size:.9rem}
input,textarea,select{
  width:100%;padding:.65rem .75rem;margin-top:.25rem;
  border-radius:10px;border:1px solid #374151;font-size:.95rem;
  background:var(--bg);color:var(--text);
}
textarea{resize:none}
button{
  padding:.65rem .9rem;border-radius:999px;border:none;
  font-weight:600;cursor:pointer;transition:.2s;
}
button:hover{transform:scale(1.02)}
button.primary{background:var(--primary);color:var(--bg);width:100%;margin-top:1rem}
button.secondary{background:#6b7280;color:#fff}
button.danger{background:var(--danger);color:#fff}
button.small{font-size:.75rem;padding:.3rem .6rem}
.row{display:grid;grid-template-columns:1fr 1fr;gap:.75rem}
.entry{
  background:var(--card);padding:.75rem 1rem;border-radius:14px;
  box-shadow:0 4px 12px rgba(0,0,0,.12);
  display:flex;justify-content:space-between;align-items:center;gap:.75rem;
}
.entry strong{font-size:.95rem}
.entry span{font-size:.85rem;color:var(--muted)}
.badge{
  display:inline-block;padding:.25rem .6rem;border-radius:999px;
  font-size:.75rem;background:var(--accent);color:#022c22;font-weight:600;
  margin:.15rem;
}
footer{text-align:center;font-size:.8rem;color:var(--muted);margin:2rem 0 1rem}
canvas{width:100%;max-height:260px;margin-top:.5rem}
</style>
</head>
<body>
<header>
  <h1>Run Fit Life</h1>
  <p>Run towards a healthier life</p>
  <button class="small" type="button" onclick="toggleDark()">ğŸŒ™ / â˜€ï¸</button>
</header>

<main>
<form id="workoutForm">
  <h2>â• Nuevo entrenamiento</h2>
  <label>DÃ­a de rutina</label>
  <select id="day" required>
    <option>DÃ­a 1 - Empuje</option>
    <option>DÃ­a 2 - TirÃ³n</option>
    <option>DÃ­a 3 - Piernas y GlÃºteo</option>
    <option>DÃ­a 4 - Abdominales</option>
  </select>

  <label>Ejercicio</label>
  <select id="exercise" required></select>

  <div class="row">
    <div><label>Peso (kg)</label><input type="number" id="weight" step="0.5" required></div>
    <div><label>Series</label><input type="number" id="sets" required></div>
  </div>

  <label>Repeticiones</label>
  <input type="number" id="reps" required>

  <label>Notas</label>
  <textarea id="notes"></textarea>

  <button class="primary" type="submit">Guardar</button>
</form>

<div class="card">
  <h2>ğŸ” Filtrar por fecha</h2>
  <input type="date" id="filterDate">
</div>

<div id="log"></div>

<div class="card">
  <h2>ğŸ“ˆ EstadÃ­sticas</h2>
  <canvas id="chart"></canvas>
  <p id="volume"></p>
  <p id="stats"></p>
</div>

<div class="card">
  <h2>ğŸ† Logros y medallas</h2>
  <div id="medals"></div>
  <p id="achievements"></p>
</div>

<div class="card">
  <h2>ğŸ“… Resumen</h2>
  <p id="weeklySummary"></p>
  <p id="monthlySummary"></p>
</div>

<div class="card">
  <h2>ğŸ’ª RÃ©cords personales</h2>
  <p id="records"></p>
</div>

<div class="card">
  <h2>âš–ï¸ Control corporal mensual</h2>
  <form id="bodyForm">
    <label>Fecha</label>
    <input type="month" id="bodyDate" required>

    <div class="row">
      <div><label>Peso (kg)</label><input type="number" step="0.1" id="bodyWeight" required></div>
      <div><label>Agua (kg)</label><input type="number" step="0.1" id="bodyWater"></div>
    </div>

    <div class="row">
      <div><label>MÃºsculo (kg)</label><input type="number" step="0.1" id="bodyMuscle"></div>
      <div><label>Grasa (kg)</label><input type="number" step="0.1" id="bodyFat"></div>
    </div>

    <div class="row">
      <div><label>Hueso sin grasa (kg)</label><input type="number" step="0.1" id="bodyBone"></div>
      <div><label>Grasa visceral</label><input type="number" step="0.1" id="bodyVisceral"></div>
    </div>

    <button class="primary" type="submit">Guardar mediciÃ³n</button>
  </form>

  <h3>ğŸ“Š Comparativa mensual</h3>
  <label>Comparar desde:</label>
  <input type="month" id="compareFrom">
  <label>Comparar hasta:</label>
  <input type="month" id="compareTo">
  <button class="secondary" onclick="compareMonths()">Comparar</button>
  <p id="comparison"></p>

  <canvas id="bodyChart"></canvas>
</div>

<div class="card">
  <h2>ğŸ“¦ GestiÃ³n de datos</h2>
  <button class="secondary" type="button" onclick="exportCSV()">Exportar CSV</button>
  <button class="secondary" type="button" onclick="exportBackup()">â¬‡ï¸ Copia de seguridad</button>
  <input type="file" id="importFile" accept="application/json" onchange="importBackup(event)">
  <button class="danger" type="button" onclick="clearAll()">Borrar todo</button>
</div>
</main>

<footer>Run Fit Life Â· PWA</footer>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
/* ================== CONFIG ================== */
const exercisesByDay = {
  'DÃ­a 1 - Empuje': {
    'Pecho': ['Press banca','Press banca inclinado','Press banca declinado','Press banca en mÃ¡quina','Aperturas en mÃ¡quina','Aperturas con mancuernas','MÃ¡quina alemana de pectoral'],
    'Hombro': ['Press militar de hombro','Elevaciones frontales de hombro','Elevaciones laterales de hombro con mancuernas','Elevaciones laterales de hombro con polea','Elevaciones frontales de hombro con barra lamine','MÃ¡quina de hombro','MÃ¡quina alemana de hombro'],
    'TrÃ­ceps': ['ExtensiÃ³n de trÃ­ceps con polea y cuerda','ExtensiÃ³n de trÃ­ceps con polea y barra','TrÃ­ceps katana','ExtensiÃ³n de trÃ­ceps por encima de la cabeza con cuerda','Fondos en mÃ¡quina sentada','Fondos en mÃ¡quina de dominadas']
  },
  'DÃ­a 2 - TirÃ³n': {
    'Espalda': ['Remo con barra','Iso-lateral row','Iso-lateral D.Y. Row','Iso-lateral high row','Iso lateral front lat pulldown','Remo con mÃ¡quina T','Remo con polea','Pullover','Face pull','Dominadas'],
    'BÃ­ceps': ['Curl de bÃ­ceps con mancuernas','Curl de bÃ­ceps con barra','Curl de bÃ­ceps banco Scott','Curl de bÃ­ceps en banco inclinado (brazos atrÃ¡s)','Curl de bÃ­ceps en polea bayesian (brazos atrÃ¡s)','Curl concentrado en mÃ¡quina','Curl martillo con mancuernas','Curl martillo en polea'],
    'Hombro posterior': ['Posterior en mÃ¡quina de aperturas','Aperturas hombro posterior','Face pull']
  },
  'DÃ­a 3 - Piernas y GlÃºteo': {
    'CuÃ¡driceps': ['Sentadilla','Prensa de pierna con discos','Prensa de pierna con mÃ¡quina','ExtensiÃ³n de cuÃ¡driceps','Sentadillas en mÃ¡quina smith','Hack sentadilla','Sentadilla bÃºlgara','Zancadas con peso'],
    'Femoral': ['Peso muerto','Femoral en mÃ¡quina sentada','Femoral en mÃ¡quina acostada','Femoral en mÃ¡quina unilateral'],
    'GlÃºteo': ['Hip thrust','Puente de glÃºteo con peso','Patada de glÃºteo con mÃ¡quina','Patada de glÃºteo con polea'],
    'Aductores/Abductores': ['Abductor en mÃ¡quina sentada','Abductor en mÃ¡quina de pie','Aductor en mÃ¡quina sentada'],
    'Gemelos': ['Gemelos']
  },
  'DÃ­a 4 - Abdominales': {
    'Core': ['Plancha isomÃ©trica','Plancha lateral','Crunch abdominal','Elevaciones de piernas','Bichos boca arriba','Abdominales oblicuos']
  }
};

const STORAGE_KEY='gym_workouts';
const BODY_KEY='body_tracking';
const qs=id=>document.getElementById(id);
const uniq=arr=>[...new Set(arr)];
const today=()=>new Date().toISOString().split('T')[0];

/* ================== ELEMENTS ================== */
const form=qs('workoutForm');
const daySelect=qs('day');
const exerciseSelect=qs('exercise');
const filterDate=qs('filterDate');
const log=qs('log');
const volumeEl=qs('volume');
const statsEl=qs('stats');
const achievementsEl=qs('achievements');
const medalsEl=qs('medals');
const weeklyEl=qs('weeklySummary');
const monthlyEl=qs('monthlySummary');
const recordsEl=qs('records');
const ctx=qs('chart');
const bodyCtx=qs('bodyChart');
let chart=null, bodyChart=null;

/* ================== DATA ================== */
function getData(){return JSON.parse(localStorage.getItem(STORAGE_KEY))||[];}
function saveData(d){localStorage.setItem(STORAGE_KEY,JSON.stringify(d));}
function getBodyData(){return JSON.parse(localStorage.getItem(BODY_KEY))||[];}
function saveBodyData(d){localStorage.setItem(BODY_KEY,JSON.stringify(d));}

/* ================== WORKOUT ================== */
function updateExerciseOptions(){
  exerciseSelect.innerHTML='';
  const day = daySelect.value;
  const groups = exercisesByDay[day];
  Object.keys(groups).forEach(groupName=>{
    const optgroup=document.createElement('optgroup');
    optgroup.label=groupName;
    groups[groupName].forEach(ex=>{
      const o=document.createElement('option'); o.textContent=ex;
      optgroup.appendChild(o);
    });
    exerciseSelect.appendChild(optgroup);
  });
  const isAbs = day==='DÃ­a 4 - Abdominales';
  qs('weight').disabled=isAbs;
  qs('weight').required=!isAbs;
  if(isAbs) qs('weight').value=0;
}

function refresh(){
  const data=getData();
  const filtered=filterDate.value?data.filter(w=>w.date===filterDate.value):data.filter(w=>w.date===today());
  renderLog(filtered);
  renderChart(filtered);
  renderStats(data);
  renderAchievements(data);
  renderMedals(data);
  renderWeekly(data);
  renderMonthly(data);
  renderRecords(data);
}

function renderLog(data){
  log.innerHTML='';
  data.forEach((w,i)=>{
    const e=document.createElement('div');
    e.className='entry';
    e.innerHTML = `
      <div>
        <strong>${w.exercise}</strong><br>
        <span>${w.weight}kg Â· ${w.sets}x${w.reps}</span><br>
        ${w.notes ? `<em>Notas: ${w.notes}</em>` : ''}
      </div>
      <button class="danger small" onclick="deleteEntry(${i})">ğŸ—‘ï¸</button>
    `;
    log.appendChild(e);
  });
}

function deleteEntry(i){const d=getData();d.splice(i,1);saveData(d);refresh();}

function renderChart(data){
  if(chart) chart.destroy();
  if(!data.length){volumeEl.textContent='';return;}
  chart=new Chart(ctx,{type:'line',data:{labels:data.map(w=>w.date),datasets:[{label:'Peso',data:data.map(w=>w.weight)}]}});
  volumeEl.textContent='Volumen total: '+data.reduce((a,w)=>a+w.weight*w.sets*w.reps,0)+' kg';
}

function renderStats(data){statsEl.textContent=`DÃ­as entrenados: ${uniq(data.map(w=>w.date)).length}`;}

function renderAchievements(data){
  const days=uniq(data.map(w=>w.date)).length;
  const msgs=['Hoy has invertido en tu salud ğŸ’š','Cada entrenamiento cuenta ğŸ”¥','HÃ¡bito en construcciÃ³n ğŸ’ª','Disciplina > motivaciÃ³n ğŸ§ ','MÃ¡s fuerte que ayer ğŸš€'];
  achievementsEl.innerHTML=`ğŸ—“ï¸ ${days} dÃ­as entrenados<br><br>${msgs[Math.floor(Math.random()*msgs.length)]}`;
}

function renderMedals(data){
  const days=uniq(data.map(w=>w.date)).length;
  medalsEl.innerHTML='';
  [['ğŸ¥‰ Inicio',1],['ğŸ¥ˆ Constancia',10],['ğŸ¥‡ Disciplina',30],['ğŸ… HÃ¡bito',60],['ğŸ‘‘ Ã‰lite',100]]
    .filter(m=>days>=m[1])
    .forEach(m=>medalsEl.innerHTML+=`<span class="badge">${m[0]}</span>`);
}

function renderWeekly(data){
  const weekAgo=new Date();weekAgo.setDate(weekAgo.getDate()-7);
  weeklyEl.textContent=`Ãšltimos 7 dÃ­as: ${data.filter(w=>new Date(w.date)>=weekAgo).length}`;
}

function renderMonthly(data){
  const n=new Date();
  monthlyEl.textContent=`Este mes: ${data.filter(w=>{const d=new Date(w.date);return d.getMonth()===n.getMonth()&&d.getFullYear()===n.getFullYear();}).length}`;
}

function renderRecords(data){
  const max={};data.forEach(w=>max[w.exercise]=Math.max(max[w.exercise]||0,w.weight));
  recordsEl.innerHTML=Object.keys(max).map(e=>`ğŸ‹ï¸ ${e}: ${max[e]} kg`).join('<br>');
}

/* ================== BODY ================== */
qs('bodyForm').addEventListener('submit',e=>{
  e.preventDefault();
  const d=getBodyData();
  d.push({
    date:qs('bodyDate').value,
    weight:+qs('bodyWeight').value,
    water:+qs('bodyWater').value||0,
    muscle:+qs('bodyMuscle').value||0,
    fat:+qs('bodyFat').value||0,
    bone:+qs('bodyBone').value||0,
    visceral:+qs('bodyVisceral').value||0
  });
  saveBodyData(d);e.target.reset();renderBodyChart();
});

function renderBodyChart(){
  const d=getBodyData();if(bodyChart) bodyChart.destroy();if(!d.length) return;
  bodyChart=new Chart(bodyCtx,{type:'line',data:{labels:d.map(x=>x.date),datasets:[
    {label:'Peso',data:d.map(x=>x.weight)},
    {label:'MÃºsculo',data:d.map(x=>x.muscle)},
    {label:'Grasa',data:d.map(x=>x.fat)}
  ]}});
}

/* ================== COMPARACIÃ“N ENTRE MESES ================== */
function compareMonths(){
  const fromMonth = qs('compareFrom').value;
  const toMonth = qs('compareTo').value;
  if(!fromMonth || !toMonth){qs('comparison').textContent='Selecciona ambos meses'; return;}
  const d=getBodyData();
  const parse = m=> new Date(m+'-01');
  const fromData = d.filter(x=>parse(x.date.slice(0,7))>=parse(fromMonth) && parse(x.date.slice(0,7))<=parse(toMonth));
  if(!fromData.length){qs('comparison').textContent='No hay datos en ese rango'; return;}
  const first = fromData[0], last = fromData[fromData.length-1];
  qs('comparison').innerHTML=`
    Diferencia entre ${fromMonth} y ${toMonth}:<br>
    Peso: ${(last.weight-first.weight).toFixed(1)} kg<br>
    MÃºsculo: ${(last.muscle-first.muscle).toFixed(1)} kg<br>
    Grasa: ${(last.fat-first.fat).toFixed(1)} kg<br>
    Hueso: ${(last.bone-first.bone).toFixed(1)} kg<br>
    Agua: ${(last.water-first.water).toFixed(1)} kg<br>
    Grasa visceral: ${(last.visceral-first.visceral).toFixed(1)}
  `;
}

/* ================== DATA EXPORT/IMPORT ================== */
function exportCSV(){
  const d=getData();
  let csv='Fecha,DÃ­a,Ejercicio,Peso,Series,Reps,Notas\n';
  d.forEach(w=>csv+=`${w.date},${w.day},${w.exercise},${w.weight},${w.sets},${w.reps},"${w.notes}"\n`);
  download(csv,'runfitlife.csv','text/csv');
}
function exportBackup(){download(JSON.stringify(getData()),'backup.json','application/json');}
function importBackup(e){const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=()=>{saveData(JSON.parse(r.result));refresh();};r.readAsText(f);} 
function clearAll(){if(confirm('Â¿Seguro?')){localStorage.clear();refresh();renderBodyChart();}}

function download(c,n,t){const a=document.createElement('a');a.href=URL.createObjectURL(new Blob([c],{type:t}));a.download=n;a.click();}

/* ================== INIT ================== */
form.addEventListener('submit',e=>{
  e.preventDefault();
  const d=getData();
  d.push({
    day:daySelect.value,
    exercise:exerciseSelect.value,
    weight:+qs('weight').value,
    sets:+qs('sets').value,
    reps:+qs('reps').value,
    notes:qs('notes').value,
    date:today()
  });
  saveData(d);
  form.reset();
  updateExerciseOptions();
  refresh();
});

daySelect.addEventListener('change',updateExerciseOptions);
filterDate.addEventListener('change',refresh);

function toggleDark(){document.body.classList.toggle('dark');}

/* InicializaciÃ³n */
filterDate.value = today();
updateExerciseOptions();
refresh();
renderBodyChart();
</script>
</body>
</html>
